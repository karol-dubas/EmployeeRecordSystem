@model IEnumerable<GroupListViewModel>
@inject Microsoft.AspNetCore.Identity.SignInManager<User> _sim;

@{
    ViewData["Title"] = "Index";
}

<link rel="stylesheet" href="~/css/group.css" />

<div asp-validation-summary="All">
</div>

<div class="page">
    @foreach (var group in Model)
    {
        <div class="card pb-0 mb-4">
            <div class="card-header">
                <h3 class="mb-0 btn-group">@group.Group.Name</h3>
                @if (_sim.IsSignedIn(User) && User.IsInRole(Roles.Admin) && group.Group.Id != 0)
                {
                    <a class="btn btn-secondary btn-group float-right" asp-controller="Group" asp-action="EditHours" asp-route-groupId="@group.Group.Id">Zmień godziny pracy grupy</a>
                }
            </div>
            <div class="card-body px-0 pt-0 pb-0">
                <table class="table table-sm table-hover mb-0">
                    <thead>
                        <tr>
                            <th class="counter" scope="col">#</th>
                            <th scope="col">Imię</th>
                            <th scope="col">Nazwisko</th>
                            <th scope="col">Stanowisko</th>
                            @if (_sim.IsSignedIn(User) && User.IsInRole(Roles.Admin))
                            {
                                <th scope="col">Przepracowane</th>
                                <th scope="col">Stawka [zł/h]</th>
                                <th scope="col"></th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int row = 1;
                            foreach (var user in group.UsersInGroup)
                            {
                                <tr>
                                    <th scope="row">@row</th>
                                    <td>@user.FirstName</td>
                                    <td>@user.LastName</td>
                                    <td>@user.PositionName</td>
                                    @if (_sim.IsSignedIn(User) && User.IsInRole(Roles.Admin))
                                    {
                                        <td>@user.TimeWorked</td>
                                        <td>@user.HourlyPay</td>
                                        <td>
                                            <a class="btn btn-secondary btn-sm"
                                               asp-controller="Administration"
                                               asp-action="@nameof(AdministrationController.EditUser)"
                                               asp-route-id="@user.Id">Edytuj</a>
                                        </td>
                                    }
                                </tr>
                                row++;
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>

@if (_sim.IsSignedIn(User) && User.IsInRole(Roles.Admin))
{
    @section footer
    {
    <footer class="border-top footer text-muted">
        <div class="container col-md-6">
            <a asp-action="AddMoney" asp-controller="Group" class="btn btn-info btn-block my-3">Wypłać pieniądze za godziny pracy użytkowników</a>
        </div>
    </footer>
    }
}